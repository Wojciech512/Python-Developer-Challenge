{% extends "base.html" %}Add commentMore actions

{% block title %}Collections{% endblock title %}

{% block content %}
      <h5 class="mb-0 p-3">{{ dataset.filename }}</h5>
      <div class="container-fluid p-3">
        <div class="card shadow-sm">
          <div class="table-responsive">
            <table id="data-table"
                   class="table table-striped table-hover mb-0 w-100"
                   style="table-layout: fixed; width: 100%;">
              <colgroup>
                {% for col in data.0.keys %}
                  <col style="width: {{ col_width }}%;">
                {% endfor %}
              </colgroup>
              <thead class="thead-light text-primary">
                <tr>
                  {% for col in data.0.keys %}
                    <th class="text-primary text-truncate">{{ col }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in data %}
                  <tr>
                    {% for val in row.values %}
                      <td class="text-truncate">{{ val }}</td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="card-footer bg-white">
            <button id="load-more" class="btn btn-outline-primary">Load more</button>
          </div>
        </div>
      </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
      let offset = {{ data|length }};
      const btn = document.getElementById('load-more');
      const tbody = document.querySelector('#data-table tbody');

      btn.addEventListener('click', function () {
        btn.disabled = true;
        fetch(`{% url 'load_more_rows' dataset.pk %}?offset=${offset}`, {
          headers: { 'X-CSRFToken': csrftoken },
          credentials: 'same-origin'
        })
        .then(res => res.json())
        .then(json => {
          json.rows.forEach(row => {
            const tr = document.createElement('tr');
            Object.values(row).forEach(val => {
              const td = document.createElement('td');
              td.textContent = val;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });
          offset += json.rows.length;
          if (json.rows.length < 10) btn.disabled = true;
        })
        .catch(() => alert('Error while loading subsequent rows'))
        .finally(() => { if (!btn.disabled) btn.disabled = false; });
      });
    });
    </script>
{% endblock content %}